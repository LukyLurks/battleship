(this.webpackJsonpbattleship=this.webpackJsonpbattleship||[]).push([[0],{13:function(e,t,a){e.exports=a(21)},18:function(e,t,a){},19:function(e,t,a){},20:function(e,t,a){},21:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(12),o=a.n(i),s=(a(18),a(2)),c=a(3),l=a(10),p=a(4),u=a(5),h=a(1),d=a(7),f=a(6);function y(e,t,a,r){for(var n="object"===typeof e?e.size:e,i=[Math.floor(t),Math.floor(a)],o=i[0],s=i[1],c=[],l=0;l<n;l++)r?c.push([o+l,s]):c.push([o,s+l]);return c}function m(e){return Math.floor(Math.random()*Math.floor(e))}function v(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];return a.every((function(t){return"number"===typeof t&&t>=0&&t<e.size}))}function b(e,t){var a=Object(c.a)(e,2),r=a[0],n=a[1],i=Object(c.a)(t,2),o=i[0],s=i[1];return r===o&&n===s}function S(e){return!0===e||!1===e}function k(e,t){return e.placedShips.some((function(e){var a=e.ship;return t===a}))}function g(e,t){for(var a=arguments.length,r=new Array(a>2?a-2:0),n=2;n<a;n++)r[n-2]=arguments[n];return y.apply(void 0,[t].concat(r)).every((function(t){return v.apply(void 0,[e].concat(Object(s.a)(t)))}))}function A(e,t){for(var a=arguments.length,r=new Array(a>2?a-2:0),n=2;n<a;n++)r[n-2]=arguments[n];return y.apply(void 0,[t].concat(r)).some((function(t){return e.placedShips.some((function(e){return e.coordinates.some((function(e){return b(e,t)}))}))}))}function O(e,t,a,r,n){return!!S(n)&&(!k(e,t)&&(!!g.apply(void 0,arguments)&&!A.apply(void 0,arguments)))}function j(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];return e.attackedAt.some((function(e){return b(e,a)}))}var C={isValidSize:function(e){return"number"===typeof e&&e>=1},isValidPoint:v,isSamePoint:b,canAddShip:O,canReceiveAttack:function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];return 2===a.length&&(!j.apply(void 0,[e].concat(a))&&!!v.apply(void 0,[e].concat(a)))},wasAttackedAt:j,getNewShipCoordinates:y,findTargetShip:function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];return e.placedShips.find((function(e){return e.coordinates.find((function(e){return b(e,a)}))}))},hitPosition:function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];var n=e.coordinates.findIndex((function(e){return b(e,a)}));return e.ship.hit(n)},findPointToAttack:function(e){for(var t=[],a=0;a<e.size;a++)for(var r=0;r<e.size;r++)j(e,a,r)||t.push([a,r]);return t[m(t.length)]},findSpotForShip:function(e,t){for(var a=!1,r=!0,n=0,i=0;!a;){r=Math.random()<.5;var o=[m(t.size),m(t.size)];O(t,e,n=o[0],i=o[1],r)&&(a=!0)}return[n,i,r]}};a(19);function B(e){return n.a.createElement("div",{className:"".concat(e.className," PlayerArea")},n.a.createElement("p",null,e.name),n.a.createElement(w,{board:e.board,onClick:e.onClick,onDragOver:e.dragOverCell,onDrop:e.dropOnCell,onDoubleClick:e.rotateShip,onDragLeave:e.leaveCell}),n.a.createElement(E,{board:e.board,ships:e.ships,ready:e.ready,onDragStart:e.dragShips,onDoubleClick:e.removeShip}))}var w=function(e){Object(d.a)(a,e);var t=Object(f.a)(a);function a(e){var r;return Object(p.a)(this,a),(r=t.call(this,e)).size=r.props.board.size,r}return Object(u.a)(a,[{key:"getShipName",value:function(e){var t=this.props.board.placedShips,a=t.map((function(e){return e.coordinates})).findIndex((function(t){return t.some((function(t){return C.isSamePoint(t,e)}))}));return a<0?null:t[a].ship.name}},{key:"makeCells",value:function(){for(var e=this,t=this.props.board.placedShips.map((function(e){return e.coordinates})).flat(),a=this.props.board.placedShips.filter((function(e){return e.ship.isSunk()})).map((function(e){return e.coordinates})).flat(),r=[],n=function(n){for(var i=function(i){var o={row:n,col:i,key:"".concat(n).concat(i)};o.ship=t.some((function(e){return C.isSamePoint(e,[n,i])})),o.attacked=C.wasAttackedAt(e.props.board,n,i),o.sunk=a.some((function(e){return C.isSamePoint(e,[n,i])})),o.shipName=e.getShipName([n,i]),r.push(o)},o=0;o<e.size;o++)i(o)},i=0;i<this.size;i++)n(i);return r}},{key:"render",value:function(){return n.a.createElement("div",{className:"board",onClick:this.props.onClick,onDragOver:this.props.onDragOver,onDrop:this.props.onDrop,onDoubleClick:this.props.onDoubleClick,onDragLeave:this.props.onDragLeave},this.makeCells().map((function(e){var t="cell";return t+=e.ship?" cellWithShip":"",t+=e.attacked?" attacked":"",t+=e.sunk?" sunk":"",n.a.createElement("div",{key:e.key,row:e.row,col:e.col,name:e.shipName,className:t})})))}}]),a}(n.a.Component),E=function(e){Object(d.a)(a,e);var t=Object(f.a)(a);function a(){return Object(p.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){var e=this;return this.props.ships?0===Object.entries(this.props.ships).length||this.props.ready?null:n.a.createElement("div",{className:"playerShips",onDragStart:this.props.onDragStart,onDoubleClick:this.props.onDoubleClick},Object.entries(this.props.ships).map((function(t){var a=Object(c.a)(t,2),r=a[0],i=a[1];return n.a.createElement(N,{key:r,name:r,board:e.props.board,ship:i})}))):null}}]),a}(n.a.PureComponent);function N(e){var t=e.board.placedShips.some((function(t){return t.ship.name===e.name})),a="ship"+(t?" placed":"");return n.a.createElement("div",{name:e.name,className:a,draggable:!0},Array(e.ship.size).fill(1).map((function(a,r){var i="cell cellWithShip";return i+=t?" placed":"",n.a.createElement("div",{key:e.name+r,className:i})})))}var D=function(e){Object(d.a)(a,e);var t=Object(f.a)(a);function a(){return Object(p.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){var e=this.props.turn?"Player":"CPU",t=this.props.turn?"CPU":"Player",a="Turn: ".concat(e);return n.a.createElement("div",{className:"GameStatus"},n.a.createElement("h1",null,"Battleship"),n.a.createElement(P,{board:this.props.board,player:t}),n.a.createElement("p",null,!this.props.ready||this.props.board.isAllSunk()?"":a),n.a.createElement(z,{board:this.props.board,player:t}),n.a.createElement(R,{onClick:this.props.restart,board:this.props.board,ships:this.props.ships}),n.a.createElement(M,{ships:this.props.ships,ready:this.props.ready}),n.a.createElement(T,{board:this.props.board,ships:this.props.ships,ready:this.props.ready,onClick:this.props.setReady}))}}]),a}(n.a.PureComponent),P=function(e){Object(d.a)(a,e);var t=Object(f.a)(a);function a(e){var r;return Object(p.a)(this,a),(r=t.call(this,e)).cols=["A","B","C","D","E","F","G","H","I","J"],r.rows=[1,2,3,4,5,6,7,8,9,10],r}return Object(u.a)(a,[{key:"formatCoords",value:function(e,t){return"".concat(this.cols[t]).concat(this.rows[e])}},{key:"formatDamage",value:function(e){var t=C.findTargetShip.apply(C,[this.props.board].concat(Object(s.a)(e)));return t?t.ship.isSunk()?"and sunk a ship":"and hit a ship":""}},{key:"render",value:function(){var e=this.props.board.attackedAt.slice(-1).flat(),t="".concat(this.props.player," attacked ").concat(this.formatCoords.apply(this,Object(s.a)(e))),a=this.formatDamage(e);return n.a.createElement("p",null,"".concat(e.length>0?t:""," ").concat(a||""))}}]),a}(n.a.PureComponent);function z(e){return e.board.isAllSunk()&&e.board.placedShips.length>0?n.a.createElement("p",null,"".concat(e.player," wins!")):null}function R(e){var t=0===e.board.placedShips.length,a=e.board.isAllSunk();return 0===Object.values(e.ships).length||!t&&a?n.a.createElement("button",{onClick:e.onClick},"New Game"):null}function T(e){var t=0===document.querySelectorAll(".playerShips .ship").length,a=Object.values(e.ships).every((function(t){return e.board.placedShips.some((function(e){var a=e.ship;return t===a}))}));return e.ready||t||!a?null:n.a.createElement("button",{onClick:e.onClick},"Start")}function M(e){return 0===Object.values(e.ships).length||e.ready?null:n.a.createElement("ul",null,n.a.createElement("li",{key:"placement"},"Drag and drop the ships below onto your board."),n.a.createElement("li",{key:"rotation"},"Double-click a ship you placed to rotate it (if it fits)."),n.a.createElement("li",{key:"removal"},"Double click a ship in the zone below to remove it."))}var L=function(e,t,a){var r={ownBoard:e,enemyBoard:t,name:a};return Object.assign(Object.create(q),r)},q={attack:function(e,t){return this.enemyBoard.receiveAttack(e,t),this}};var I={attackRandom:function(){return C.findPointToAttack(this.enemyBoard)},addShipRandom:function(e){var t,a=C.findSpotForShip(e,this.ownBoard);return(t=this.ownBoard).addShip.apply(t,[e].concat(Object(s.a)(a)))}},x=function(e,t){if(!function(e){return"number"===typeof e&&e>=1}(e))return null;var a={size:Math.floor(e),name:t,damagedAt:Array(Math.floor(e)).fill(!1)};return Object.assign(Object.create(F),a)},F={deepClone:function(){var e={size:this.size,name:this.name,damagedAt:Array.from(this.damagedAt)};return Object.assign(Object.create(F),e)},hit:function(e){if(!function(e,t){return"number"===typeof e&&e>=0&&e<t}(e,this.size))return this;var t=this.deepClone();return t.damagedAt[Math.floor(e)]=!0,t},isSunk:function(){return this.damagedAt.every((function(e){return!0===e}))}};var G=function(e){if(!C.isValidSize(e))return null;var t={size:Math.floor(e),placedShips:[],attackedAt:[]};return Object.assign(Object.create(J),t)},J={deepClone:function(){var e={size:this.size,placedShips:Array.from(this.placedShips),attackedAt:Array.from(this.attackedAt)};return Object.assign(Object.create(J),e)},addShip:function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];if(!C.canAddShip.apply(C,[this].concat(Array.prototype.slice.call(arguments))))return this;var n=this.deepClone();return n.placedShips.push({ship:e,coordinates:C.getNewShipCoordinates.apply(C,arguments)}),n},removeShip:function(e){var t=this.deepClone();return t.placedShips=t.placedShips.filter((function(t){return t.ship.name!==e})),t},receiveAttack:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];if(!C.canReceiveAttack.apply(C,[this].concat(t)))return this;var r=C.findTargetShip.apply(C,[this].concat(t));return void 0!==r&&(r.ship=C.hitPosition.apply(C,[r].concat(t))),this.recordAttack(t)},recordAttack:function(e){var t=this.deepClone();return t.attackedAt.push(e),t},isAllSunk:function(){return this.placedShips.every((function(e){return e.ship.isSunk()}))}},U=function(){return{patrolBoat:x(2,"patrolBoat"),submarine:x(3,"submarine"),destroyer:x(3,"destroyer"),battleship:x(4,"battleship"),carrier:x(5,"carrier")}},V=function(){var e,t,a,r=G(10),n=G(10),i=Object.values(U()),o=L(r,n,"Player"),s=(e=n,t=r,a="CPU",Object.assign(Object.create(I),L(e,t,a)));return i.forEach((function(e){s.ownBoard=s.addShipRandom(e)})),{player:o,cpu:s,playerShips:U()}},W=(a(20),function(e){Object(d.a)(a,e);var t=Object(f.a)(a);function a(e){var r;return Object(p.a)(this,a),(r=t.call(this,e)).game={player:L(G(10),G(10),""),cpu:L(G(10),G(10),"")},r.state={playerBoard:r.game.player.ownBoard,playerShips:{},selectedShipName:"",cpuBoard:r.game.cpu.ownBoard,playerTurn:!0,playerReady:!1},r.handleAttack=r.handleAttack.bind(Object(h.a)(r)),r.makeCpuAttack=r.makeCpuAttack.bind(Object(h.a)(r)),r.restart=r.restart.bind(Object(h.a)(r)),r.setReady=r.setReady.bind(Object(h.a)(r)),r.dragShips=r.dragShips.bind(Object(h.a)(r)),r.dragOverCell=r.dragOverCell.bind(Object(h.a)(r)),r.leaveCell=r.leaveCell.bind(Object(h.a)(r)),r.dropOnCell=r.dropOnCell.bind(Object(h.a)(r)),r.removeShip=r.removeShip.bind(Object(h.a)(r)),r.rotateShip=r.rotateShip.bind(Object(h.a)(r)),r}return Object(u.a)(a,[{key:"restart",value:function(){this.game=V(),this.setState({playerBoard:this.game.player.ownBoard,playerShips:this.game.playerShips,cpuBoard:this.game.cpu.ownBoard,playerTurn:!0,playerReady:!1})}},{key:"setReady",value:function(){this.setState({playerReady:!0})}},{key:"handleAttack",value:function(e){var t,a,r=this,n=e.target,i=e.type;if(this.shouldAcceptAttack(i)){var o=this.state.playerTurn?{board:this.state.cpuBoard,boardName:"cpuBoard"}:{board:this.state.playerBoard,boardName:"playerBoard"},s=[+n.getAttribute("row"),+n.getAttribute("col")],c=(t=o.board).receiveAttack.apply(t,s);c!==o.board&&this.setState((a={},Object(l.a)(a,o.boardName,c),Object(l.a)(a,"playerTurn",!this.state.playerTurn),a),(function(){c.isAllSunk()||r.state.playerTurn||setTimeout(r.makeCpuAttack,1500)}))}}},{key:"shouldAcceptAttack",value:function(e){return!!this.state.playerReady&&(!(!this.state.playerTurn&&"click"===e)&&(!this.state.cpuBoard.isAllSunk()&&!this.state.playerBoard.isAllSunk()))}},{key:"makeCpuAttack",value:function(){this.game.cpu.enemyBoard=this.state.playerBoard;var e=this.game.cpu.attackRandom(),t=Object(c.a)(e,2),a=t[0],r=t[1],n=document.querySelector('.playerOneArea .cell[row="'.concat(a,'"][col="').concat(r,'"]'));this.handleAttack({target:n,getAttribute:function(e){return"row"===e?a:r}})}},{key:"dragShips",value:function(e){var t=e.target;t.classList.contains("ship")&&this.setState({selectedShipName:t.getAttribute("name")})}},{key:"dragOverCell",value:function(e){var t=e.target;if(t.classList.contains("cell")){var a=this.state.playerShips[this.state.selectedShipName],r=this.state.playerBoard,n=[+t.getAttribute("row"),+t.getAttribute("col")],i=C.canAddShip.apply(C,[r,a].concat(n,[!0])),o=C.canAddShip.apply(C,[r,a].concat(n,[!1])),s=!!i||!o&&null;if(null!==s)C.getNewShipCoordinates.apply(C,[a].concat(n,[s])).map((function(e){var t=Object(c.a)(e,2),a=t[0],r=t[1];return document.querySelector('.playerOneArea .cell[row="'.concat(a,'"][col="').concat(r,'"]'))})).forEach((function(e){return e.classList.add("canBePlaced")})),e.preventDefault()}}},{key:"leaveCell",value:function(e){e.target;var t=document.querySelectorAll(".playerOneArea .cell");Object(s.a)(t).forEach((function(e){return e.classList.remove("canBePlaced")}))}},{key:"dropOnCell",value:function(e){var t,a=e.target;if(a.classList.contains("canBePlaced")){var r=this.state.playerShips[this.state.selectedShipName],n=[+a.getAttribute("row"),+a.getAttribute("col")],i=this.state.playerBoard,o=C.canAddShip.apply(C,[i,r].concat(n,[!0])),s=C.canAddShip.apply(C,[i,r].concat(n,[!1])),c=!!o||!s&&null;this.setState({playerBoard:(t=this.state.playerBoard).addShip.apply(t,[r].concat(n,[c]))})}}},{key:"removeShip",value:function(e){var t=e.target.parentNode.getAttribute("name");this.setState({playerBoard:this.state.playerBoard.removeShip(t)})}},{key:"rotateShip",value:function(e){var t=e.target;if(t.classList.contains("cellWithShip")){var a,r=this.state.playerBoard.deepClone(),n=this.state.playerBoard.placedShips.find((function(e){return e.ship.name===t.getAttribute("name")})),i=n.coordinates[0],o=n.coordinates.every((function(e){var t=Object(c.a)(e,2);t[0];return t[1]===i[1]}));if(r=r.removeShip(n.ship.name),C.canAddShip.apply(C,[r,n.ship].concat(Object(s.a)(i),[!o])))r=(a=r).addShip.apply(a,[n.ship].concat(Object(s.a)(i),[!o])),this.setState({playerBoard:r})}}},{key:"render",value:function(){return n.a.createElement("div",{className:"App"},n.a.createElement(D,{turn:this.state.playerTurn,setReady:this.setReady,ready:this.state.playerReady,board:this.state.playerTurn?this.state.playerBoard:this.state.cpuBoard,ships:this.state.playerShips,restart:this.restart}),n.a.createElement("div",{className:"players"},n.a.createElement(B,{className:"playerOneArea",name:this.game.player.name,board:this.state.playerBoard,ships:this.state.playerShips,ready:this.state.playerReady,dragShips:this.dragShips,dragOverCell:this.dragOverCell,leaveCell:this.leaveCell,dropOnCell:this.dropOnCell,removeShip:this.removeShip,rotateShip:this.rotateShip}),n.a.createElement(B,{className:"playerTwoArea",name:this.game.cpu.name,board:this.state.cpuBoard,onClick:this.handleAttack})))}}]),a}(n.a.Component));o.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(W,null)),document.getElementById("root"))}},[[13,1,2]]]);
//# sourceMappingURL=main.62a0cd21.chunk.js.map